name: STAGE

on:
  push:
    branches: [ "stage" ]

env:
  REGISTRY: carloslo1
  IMAGE_NAME: kubelabs_publicapi
  OPS_REPO: carloslo1/Ops
  OPS_BRANCH: main


jobs:
 build:
   runs-on: ubuntu-latest
   steps:
     - name: checkout code
       uses: actions/checkout@v3
       with:
         fetch-depth: 0

     - name: Login to Docker
       uses: docker/login-action@v2
       with:
         username: ${{ secrets.DOCKER_USERNAME }}
         password: ${{ secrets.DOCKER_PASSWORD }}

     - name: Build & push
       uses: docker/build-push-action@v3
       with:
         push: true
         tags: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest
         build-args: |
           APP_ENV=${{ secret.APP_ENV }}